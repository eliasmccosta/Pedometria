---
date: "2020-06-02"
diagram: true
image:
  caption: 'Image credit: [**Elias**](https://www.instagram.com/eliasmendescosta/)'
  focal_point: ""
  placement: 3
math: true
title: Ferramentas pedom√©tricas
subtitle: 'Ferramentas pedom√©tricas para an√°lise de pedologia quantitativa'
summary: ''
bibliography: [references.bib]
link-citations: true 
csl: [geoderma-regional.csl]
authors:
- admin
categories:
  - R
  - Programa√ß√£o
tags:
  - MDS
  - Pedometria
nocite: | 
  @R-bookdown
---



<div id="introdu√ß√£o" class="section level1">
<h1>Introdu√ß√£o</h1>
<p>Nesse tutorial ser√£o abordados atrav√©s do Algoritmos para Pedologia Quantitativa (AQP em ingl√™s) e pacotes auxiliares uma cole√ß√£o de c√≥digos, ideias, e plotes usando o software R <span class="citation">(R Core Team, <a href="#ref-R2019">2019</a>)</span>. Toda a teoria por tr√°s de grande parte do c√≥digo pode ser encontrada no artigo <a href="https://www.sciencedirect.com/science/article/pii/S009830041200369X?via%3Dihub"><em>Algorithms for quantitative pedology: A toolkit for soil scientists</em></a> <span class="citation">(Beaudette et al., <a href="#ref-Beaudette2013">2013</a>)</span>. Al√©m disso artigos disso alguns exemplos de aplica√ß√µes das ferramentas podem se encontrados em <span class="citation">Pinheiro et al. (<a href="#ref-Pinheiro2016">2016</a>)</span> e <span class="citation">Pinheiro et al. (<a href="#ref-Pinheiro2018">2018</a>)</span>. Para fins did√°ticos o tutorial foi dividido em tr√™s partes e os pacotes usados ser√£o <code>soilDB</code>, que contem uma base de dados de solos para an√°lises pedom√©tricas, <code>AQP</code> que contem as principais ferramentas de pedologia quantitativa usadas no tutorial, <code>sharpshootR</code> que contem uma coel√ß√£o de fun√ß√µes que d√£o suporte ao levantamento e explora√ß√£o de dados de solos, <code>SP</code> um pacote que fornece classes e m√©todos para dados espaciais: pontos, linhas, pol√≠gonos e grades, <code>Hmisc</code> que cont√©m muitas fun√ß√µes √∫teis para an√°lise de dados, gr√°ficos de alto n√≠vel, opera√ß√µes utilit√°rias, fun√ß√µes para calcular o tamanho de amostras, importar e manipular conjuntos de dados, imputar valores ausentes, cria√ß√£o avan√ßada de tabelas, an√°lise de cluster entre outras fun√ß√µes, <code>lattice</code> que √© um sistema de visualiza√ß√£o de dados de alto n√≠vel, poderoso e elegante, com √™nfase em dados multivariados, <code>MASS</code> com fun√ß√µes e conjuntos de dados para apoiar Venables e Ripley, <strong>Modern Applied Statistics with S</strong>, <code>plyr</code> que contem um conjunto de ferramentas que resolve problemas tais como: Divis√£o, aplica√ß√£o e combina√ß√£o de dados e <code>cluster</code> que um pacote com m√©dodos para an√°lise de cluster a fim de encontrar grupos em conjunto de dados.</p>
<div id="base-de-dados-dos-exerc√≠cios" class="section level2">
<h2>Base de dados dos exerc√≠cios</h2>
<p>Todos os dados usados nos exerc√≠cios ou s√£o do pacote <code>AQP</code> ou s√£o do pacote <code>soilDB</code>. Muitas das informa√ß√µes contidas nesse tutorial foram extra√≠das do <a href="http://ncss-tech.github.io/AQP/">projeto do AQP</a> e todo cr√©dito √© dado ao autor.</p>
<pre class="r"><code># Carregando os pacotes no R
library(soilDB) 
library(aqp)  
library(sharpshootR) 
library(sp) 
library(Hmisc)
library(lattice)
library(MASS)
library(plyr)
library(cluster)</code></pre>
</div>
</div>
<div id="parte-i" class="section level1">
<h1>Parte I</h1>
<p>Na parte I ser√£o abordadas caracter√≠sticas das fun√ß√µes b√°sicas do <em>AQP</em>, conceito de cole√ß√£o de perfis de solos, <strong>SoilProfileCollection</strong>, e verifica√ß√£o da estrutura de dados na cole√ß√£o, al√©m de alguns plotes b√°sicos.
A classe <strong>SoilProfileCollection</strong> foi projetada para simplificar o processo de trabalhar com a cole√ß√£o de dados associados aos perfis de solo: dados em n√≠vel de local (site), dados em n√≠vel de horizonte, dados espaciais, dados de horizontes de diagn√≥sticos, metadados, etc. Os exemplos listados abaixo devem ser copiados/colados deste documento e executados de forma interativa em R. Lembrando que antes de execultar voc√™ deve instalar e carregar todas as bibliot√©cas (pacotes) mencionados.</p>
<div id="cria√ß√£o-de-objetos" class="section level2">
<h2>Cria√ß√£o de Objetos</h2>
<p>Os objetos <strong>SoilProfileCollection</strong> geralmente s√£o criados pela atrav√©s de objetos <em>data.frame</em> (tabelas retangulares de dados) que cont√™m pelo menos tr√™s colunas essenciais:</p>
<ul>
<li>Uma coluna de identifica√ß√£o que identifica exclusivamente grupos de horizontes (por exemplo, <em>pedons</em>)</li>
<li>Limites superiores do horizonte</li>
<li>Limites inferiores do horizonte</li>
</ul>
<p>O <em>data.frame</em> deve ser pr√©-classificado de acordo com o ID do perfil e o limite superior do horizonte. A nota√ß√£o de f√≥rmula √© usada para definir as colunas usadas para promover um objeto <em>data.frame</em>.</p>
<pre class="r"><code># Carregando dados de solos
# upgrade para SoilProfileCollection
# &#39;id&#39; √© o nome da coluna que cont√©m o ID do perfil
# &#39;top&#39; √© o nome da coluna que cont√©m os limites superiores do horizonte
# &#39;bottom&#39; √© o nome da coluna que cont√©m os limites inferiores do horizonte
data(sp1) # Conjunto de dados sp4 do pacote AQP (data.frame)
aqp::depths(sp1) &lt;- id ~ top + bottom 
aqp::site(sp1) &lt;- ~ group </code></pre>
</div>
<div id="acessando-configurando-e-substituindo-dados" class="section level2">
<h2>Acessando, configurando e substituindo dados</h2>
<p>As fun√ß√µes de acesar s√£o usadas para extrair componentes espec√≠ficos dos objetos <strong>SoilProfileCollection</strong>.</p>
<pre class="r"><code># M√©todos para inpens√£o dos objetos
aqp::idname (sp1) # auto-explicativo</code></pre>
<pre><code>## [1] &quot;id&quot;</code></pre>
<pre class="r"><code>aqp::horizonDepths(sp1) # auto-explicativo</code></pre>
<pre><code>## [1] &quot;top&quot;    &quot;bottom&quot;</code></pre>
<pre class="r"><code>aqp::depth_units(sp1) # defaults &#39;cm&#39;</code></pre>
<pre><code>## [1] &quot;cm&quot;</code></pre>
<pre class="r"><code>aqp::metadata(sp1) # </code></pre>
<pre><code>##   depth_units
## 1          cm</code></pre>
<pre class="r"><code>aqp::profile_id(sp1) # vector com IDs dos perfis</code></pre>
<pre><code>## [1] &quot;P001&quot; &quot;P002&quot; &quot;P003&quot; &quot;P004&quot; &quot;P005&quot; &quot;P006&quot; &quot;P007&quot; &quot;P008&quot; &quot;P009&quot;</code></pre>
<pre class="r"><code>aqp::horizonNames(sp1) # coluna com osnomes dos dados dos horizontes</code></pre>
<pre><code>##  [1] &quot;id&quot;               &quot;top&quot;              &quot;bottom&quot;           &quot;bound_distinct&quot;  
##  [5] &quot;bound_topography&quot; &quot;name&quot;             &quot;texture&quot;          &quot;prop&quot;            
##  [9] &quot;structure_grade&quot;  &quot;structure_size&quot;   &quot;structure_type&quot;   &quot;stickiness&quot;      
## [13] &quot;plasticity&quot;       &quot;field_ph&quot;         &quot;hue&quot;              &quot;value&quot;           
## [17] &quot;chroma&quot;           &quot;hzID&quot;</code></pre>
<pre class="r"><code>aqp::siteNames(sp1) # coluna com os nomes do dados dos locais (site data)</code></pre>
<pre><code>## [1] &quot;id&quot;    &quot;group&quot;</code></pre>
<pre class="r"><code>length(sp1) # n√∫mero de perfis na cole√ß√£o</code></pre>
<pre><code>## [1] 9</code></pre>
<pre class="r"><code>nrow(sp1) # n√∫mero de horizontes na cole√ß√£o</code></pre>
<pre><code>## [1] 60</code></pre>
<pre class="r"><code>names(sp1) # nomes de colunas dos dados do site e do horizonte, concatenados em um √∫nico vetor</code></pre>
<pre><code>##          horizons1          horizons2          horizons3          horizons4 
##               &quot;id&quot;              &quot;top&quot;           &quot;bottom&quot;   &quot;bound_distinct&quot; 
##          horizons5          horizons6          horizons7          horizons8 
## &quot;bound_topography&quot;             &quot;name&quot;          &quot;texture&quot;             &quot;prop&quot; 
##          horizons9         horizons10         horizons11         horizons12 
##  &quot;structure_grade&quot;   &quot;structure_size&quot;   &quot;structure_type&quot;       &quot;stickiness&quot; 
##         horizons13         horizons14         horizons15         horizons16 
##       &quot;plasticity&quot;         &quot;field_ph&quot;              &quot;hue&quot;            &quot;value&quot; 
##         horizons17         horizons18               site 
##           &quot;chroma&quot;             &quot;hzID&quot;            &quot;group&quot;</code></pre>
<pre class="r"><code>min(sp1) # profundidade de perfil mais raso da cole√ß√£o</code></pre>
<pre><code>## [1] 59</code></pre>
<pre class="r"><code>max(sp1) # profundidade de perfil mais profundo da cole√ß√£o</code></pre>
<pre><code>## [1] 240</code></pre>
</div>
<div id="dados-do-horizonte-e-do-site-local" class="section level2">
<h2>Dados do horizonte e do site (local)</h2>
<p>Normalmente, os dados do horizonte e do site s√£o os componentes mais importantes dos objetos SoilProfileCollection. Ambos s√£o armazenados internamente como objetos data.frame; com uma ou mais linhas (por ID do perfil) na tabela do horizonte e uma linha (por ID do perfil) na tabela do site. As colunas de qualquer tabela podem ser acessadas com a nota√ß√£o <code>$</code>. Novos dados podem ser atribu√≠dos a qualquer tabela da mesma maneira, desde que o comprimento dos novos dados seja:</p>
<ul>
<li>Mesmo tamanho que o n√∫mero de perfis na cole√ß√£o (o destino √© a tabela de sites).</li>
<li>Mesmo comprimento que o n√∫mero de horizontes na cole√ß√£o (o destino √© a tabela do horizonte).</li>
</ul>
</div>
<div id="plotando-soilprofilecollection" class="section level2">
<h2>Plotando <strong>SoilProfileCollection</strong></h2>
<p>O m√©todo <code>plot()</code> para objetos <strong>SoilProfileCollection</strong> gera esbo√ßos de perfis na cole√ß√£o com base nos limites dos horizontes, alinhados verticalmente a uma sequ√™ncia inteira de 1 ao n√∫mero de perfis. Os nomes dos horizontes s√£o extra√≠dos automaticamente de um nome de atributo no n√≠vel do horizonte (se presente) ou por meio de um atributo alternativo fornecido como argumento: <code>name = 'nomedacoula'</code>. As cores do horizonte s√£o geradas automaticamente a partir do atributo no n√≠vel do horizonte <code>soil_color</code>, ou qualquer outro atributo da descri√ß√£o de cor compat√≠vel com R, fornecido como argumento: <code>color = 'nomedacoula'</code>. Essa fun√ß√£o √© altamente personaliz√°vel; portanto, √© prudente consultar a ajuda <code>(plotSPC)</code> de tempos em tempos. As cores do solo na nota√ß√£o Munsell podem ser convertidas em cores compat√≠veis com R via <code>munsell2rgb()</code>.</p>
<pre class="r"><code>data(sp4) # Conjunto de dados sp4 do pacote AQP (data.frame)
aqp::depths(sp4) &lt;- id ~ top + bottom 
# Atribui√ß√£o de novos dados a atributos existentes ou novos
sp4$elevation &lt;- rnorm(n=length(sp4), mean=1000, sd=150) # no n√≠vel do site, com base no comprimento dos dados atribu√≠dos
sp4$thickness &lt;- sp4$bottom - sp4$top # n√≠vel do horizonte
# Extra√ß√£o de atributos espec√≠ficos por nome
sp4$clay # Vetor de conte√∫do de argila (dados do horizonte)</code></pre>
<pre><code>##  [1] 21 27 32 55 25 34  3 15 27 32 25 31 33 13 21 23 15 17 12 19 14 14 22 25 40
## [26] 51 67 24 25 32</code></pre>
<p>Os dados do horizonte e do local (site) tamb√©m podem ser modificados por extra√ß√£o para um data.frame, seguidos pela substitui√ß√£o (dados do horizonte) ou jun√ß√£o (dados do site). Observe que, embora essa abordagem ofere√ßa a maior flexibilidade, ela tamb√©m √© a mais perigosa - a substitui√ß√£o dos dados do horizonte por novos dados que n√£o est√£o exatamente de acordo com a classifica√ß√£o original pode corromper seu <strong>SoilProfileCollection</strong>.</p>
<pre class="r"><code># extrair dados os horizontes para o data.frame
h &lt;- aqp::horizons(sp4)
# Adicionar uma nova coluna e salvar de volta no objeto
h$random.numbers &lt;- rnorm(n=nrow(h), mean=0, sd=1)
# repor dados originais dos horizontes com vers√£o modificada
#!a ordem das linhas n√£o deve ser alterada!
horizons(sp4) &lt;- h
# extrair dados do site para o data.frame
s &lt;- aqp::site(sp4)
# Adicionar um grupo para o site fake
s$group &lt;- base::factor(rep(c(&#39;A&#39;, &#39;B&#39;), length.out=nrow(s)))
# junte novos dados do site com dados anteriores: os dados antigos n√£o s√£o substitu√≠dos
site(sp4) &lt;- s
# Verificar
sp4</code></pre>
<pre><code>## Object of class SoilProfileCollection
## Number of profiles: 10
## Depth range: 16-49 cm
## 
## Horizon attributes:
##       id name top bottom   K   Mg  Ca CEC_7 ex_Ca_to_Mg sand silt clay   CF
## 1 colusa    A   0      3 0.3 25.7 9.0  23.0        0.35   46   33   21 0.12
## 2 colusa  ABt   3      8 0.2 23.7 5.6  21.4        0.23   42   31   27 0.27
## 3 colusa  Bt1   8     30 0.1 23.2 1.9  23.7        0.08   40   28   32 0.27
## 4 colusa  Bt2  30     42 0.1 44.3 0.3  43.0        0.01   27   18   55 0.16
## 5  glenn    A   0      9 0.2 21.9 4.4  18.8        0.20   54   20   25 0.55
## 6  glenn   Bt   9     34 0.3 18.9 4.5  27.5        0.20   49   18   34 0.84
##   hzID thickness random.numbers
## 1    1         3     -2.5303205
## 2    2         5     -0.5528336
## 3    3        22      1.4824306
## 4    4        12     -0.4329013
## 5    5         9      0.6168055
## 6    6        25      0.2635036
## 
## Sampling site attributes:
##          id elevation group
## 1    colusa  987.2647     A
## 2     glenn 1118.7420     B
## 3     kings 1310.9922     A
## 4  mariposa 1007.5345     B
## 5 mendocino 1161.0391     A
## 6      napa 1092.4668     B</code></pre>
<pre class="r"><code># Fazendo um plot simples
plot(sp4, name=&#39;name&#39;)
# title, note line argument:
title(&#39;Perfis de Solo&#39;, line=1, cex.main=0.75)
# profiles are centered at integers, from 1 to length(obj)
axis(1, line=0, at=1:15, cex.axis=0.75, font=4, col=&#39;blue&#39;, col.axis=&#39;blue&#39;, lwd=2)
mtext(&#39;Perfis&#39;, side=1, line=2, font=4, col=&#39;blue&#39;)
# y-axis is based on profile depths
axis(2, line=-1, at=pretty(1:max(sp4)), cex.axis=0.75, font=4, las=1, col=&#39;blue&#39;, col.axis=&#39;blue&#39;, lwd=2)
mtext(&#39;Profundidade&#39;, side=2, line=1, font=4, col=&#39;blue&#39;)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code># plot com separa√ß√£o de grupos
aqp::groupedProfilePlot(sp4, groups=&#39;group&#39;, max.depth=60, group.name.offset = -5, id.style=&#39;side&#39;)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<pre class="r"><code># Esbo√ßos Tem√°ticos
sp4$clay # </code></pre>
<pre><code>##  [1] 21 27 32 55 25 34  3 15 27 32 25 31 33 13 21 23 15 17 12 19 14 14 22 25 40
## [26] 51 67 24 25 32</code></pre>
<pre class="r"><code>par(mar=c(1,1,3,1)) # tighter figure margins
plot(sp4, name=&#39;name&#39;, color=&#39;clay&#39;,cex.names=0.5,cex.id=0.5, id.style=&#39;top&#39;,col.legend.cex=1,family=&quot;serif&quot;, col.label=&#39;Argila&#39;, )</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-7-3.png" width="672" /></p>
<pre class="r"><code>sp4$Ca # </code></pre>
<pre><code>##  [1]  9.0  5.6  1.9  0.3  4.4  4.5  1.4  7.0  4.4  5.8  6.2  6.2  4.4  2.2  3.4
## [16]  3.7 24.1 21.5  0.7  5.6  3.5  2.0  6.6  4.1  3.5  1.5  0.8 16.3 16.5 13.7</code></pre>
<pre class="r"><code>par(mar=c(1,1,3,1)) # tighter figure margins
plot(sp4, name=&#39;name&#39;, color=&#39;Ca&#39;,cex.names=0.5,cex.id=0.5, id.style=&#39;top&#39;,col.legend.cex=1,
     col.label=&#39;Ca&#39;, family=&quot;serif&quot;)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-7-4.png" width="672" /></p>
<pre class="r"><code>sp4$name # </code></pre>
<pre><code>##  [1] &quot;A&quot;   &quot;ABt&quot; &quot;Bt1&quot; &quot;Bt2&quot; &quot;A&quot;   &quot;Bt&quot;  &quot;A&quot;   &quot;Bt1&quot; &quot;Bt2&quot; &quot;A&quot;   &quot;Bt1&quot; &quot;Bt2&quot;
## [13] &quot;Bt3&quot; &quot;A&quot;   &quot;Bt1&quot; &quot;Bt2&quot; &quot;A&quot;   &quot;Bt&quot;  &quot;A&quot;   &quot;Bt&quot;  &quot;A&quot;   &quot;Bt&quot;  &quot;A1&quot;  &quot;A2&quot; 
## [25] &quot;AB&quot;  &quot;Bt1&quot; &quot;Bt2&quot; &quot;A&quot;   &quot;Bt1&quot; &quot;Bt2&quot;</code></pre>
<pre class="r"><code>par(mar=c(2,2,3,2)) # tighter figure margins
plot(sp4, name=&#39;name&#39;, color=&#39;name&#39;, col.palette=RColorBrewer::brewer.pal(9, &#39;Set1&#39;), col.label=&#39;Nomes dos Horizontes&#39;, 
     cex.names=0.5)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-7-5.png" width="672" /></p>
<pre class="r"><code>###############
### Boxplot ###
# Aqui usaremos o conjunto sp1
sp1$name1 &lt;- aqp::generalize.hz(sp1$name, 
                           new=c(&#39;A&#39;,&#39;AB&#39;, &#39;BA&#39;,&#39;B&#39;,&#39;BC&#39;, &#39;C&#39;, &#39;E&#39;, &#39;AE&#39;, &#39;O&#39;, &#39;H&#39;, &#39;R&#39;, &#39;2C&#39;, &#39;3C&#39;, &#39;3B&#39;, &#39;3A&#39;), 
                           pat=c(&#39;^A&#39;,&#39;^AB&#39;,&#39;^BA&#39;,&#39;^B&#39;,&#39;^BC&#39;,&#39;^C&#39;, &#39;^E&#39;, &#39;^AE&#39;, &#39;^O&#39;, &#39;^H&#39;, &#39;^R&#39;, &#39;^2C&#39;, &#39;^3C&#39;,&#39;^3B&#39;, &#39;^3A&#39; ))

# compute horizon mid-points 
sp1$mid &lt;- with(horizons(sp1), (top+ bottom)/2)
# sort horizon designation by group-wise median values 
hz.designation.by.median.depths &lt;- names(sort(tapply(sp1$mid, sp1$name1, median)))
# plot the distribution of horizon mid-points by designation 
lattice::bwplot(mid ~ factor(name, levels=hz.designation.by.median.depths),
       data=horizons(sp1),       
       ylim=c(200, 0), ylab=&#39;Profundidade do ponto m√©dio do horizonte (cm)&#39;,       
       scales=list(y=list(tick.number=10)),       
       panel= function ( ... ) {
         panel.abline(h=seq(0, 180, by=10), v=1:length(hz.designation.by.median.depths), col=grey(0.8), lty=3)    
         panel.bwplot( ... ) })</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-7-6.png" width="672" /></p>
<pre class="r"><code>lattice::bwplot(prop~ factor(name1, levels=hz.designation.by.median.depths),
       data=horizons(sp1),       
       ylab=&#39;Profundidade&#39;,       
       scales=list(y=list(tick.number=10)),       
       panel= function ( ... ) {  
         panel.abline(h=seq(0, 600, by=50), v=1:length(hz.designation.by.median.depths), col=grey(0.8), lty=3)  
         panel.bwplot( ... ) })</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-7-7.png" width="672" /></p>
<p>#Parte II</p>
</div>
<div id="fun√ß√µes-de-fatiamento-slice" class="section level2">
<h2>Fun√ß√µes de fatiamento (slice)</h2>
<p>Cole√ß√µes de perfis de solo podem ser fatiadas (ou reamostradas) em intervalos regulares de profundidade com a fun√ß√£o <code>slice()</code>. A estrutura de fatiamento e as vari√°veis de interesse s√£o definidas por meio de nota√ß√£o de f√≥rmula: seq ~ var.1 + var.2 + var.3 + ‚Ä¶ onde seq √© uma sequ√™ncia de n√∫meros inteiros (por exemplo, 0:15, c (5,10,15,20) etc.) e var.1 + var.2 + var.3 + ‚Ä¶ s√£o atributos no horizonte que se deja fatiar. As vari√°veis cont√≠nuas e categ√≥ricas podem ser nomeadas no lado direito da f√≥rmula. Os resultados retornados pela fun√ß√£o <code>slice ()</code> s√£o <strong>SoilProfileCollection</strong> ou <strong>data.frame</strong> quando chamados com o argumento opcional <em>just.the.data = TRUE</em>. Por exemplo, para dividir nosso conjunto de dados de amostra em intervalos de 1 cm, de 0 a 15 cm:</p>
<pre class="r"><code># fatiar dados
sliced &lt;- aqp::slice(sp4, fm= 0:50 ~ sand + silt + clay)
# verificar o resultado
class(sliced)</code></pre>
<pre><code>## [1] &quot;SoilProfileCollection&quot;
## attr(,&quot;package&quot;)
## [1] &quot;aqp&quot;</code></pre>
<pre class="r"><code># fatiar de 0 at√© a profundidade m√°xima dos perfis da cole√ß√£o
sliced &lt;- aqp::slice(sp4, fm= 0:max(sp4) ~ sand + silt + clay)
# Extraia todos os dados na faixa de 5--10 cm:
plot(sliced[, 5:10])</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code># Extraia todos os dados na faixa de 25 a 50 cm:
plot(sliced[, 25:50])</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<pre class="r"><code># Extraia todos os dados na faixa de 0--5, 10--20 e 40--50 cm:
plot(sliced[, c(0:5, 10:20, 40:50)])</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-8-3.png" width="672" />
## Agregando cole√ß√µes de perfis de solo em ‚Äúslabs‚Äù regulares
O resumo detalhado dos atributos no n√≠vel de horizonte √© realizado com a fun√ß√£o <code>slab()</code>. Os crit√©rios de agrupamento de perfis e a sele√ß√£o de atributos do horizonte s√£o parametrizados por meio da f√≥rmula: grupos ~ var1 + var2 + var3 onde vari√°veis nomeadas s√£o agregadas em grupos ou onde vari√°veis nomeadas s√£o agregadas em toda a cole√ß√£o com f√≥rmula: cole√ß√£o ~ var1 + var2 + var3. A fun√ß√£o de resumo padr√£o <em>(slab.fun)</em> calcula os percentis 5, 25, 50, 75 e 95 atrav√©s do estimador de quantil Harrell-Davis.</p>
<p>A estrutura de profundidade (‚Äúslabs‚Äù) sobre a qual os resumos s√£o calculados √© definida com o argumento <code>slab.structure</code> usando:</p>
<ul>
<li>Um √∫nico n√∫mero inteiro (por exemplo, 10): os dados s√£o agregados em uma sequ√™ncia regular de <em>slabs</em> de 10 unidades de espessura.</li>
<li>Um vetor de 2 n√∫meros inteiros (por exemplo, c (50, 60)): os dados s√£o agregados em profundidades que variam de 50 a 60 unidades.
-Um vetor de 3 ou mais n√∫meros inteiros (por exemplo, c (0, 5, 10, 50, 100)): os dados s√£o agregados nas profundidades que variam de 0 a 5, 5 a 10, 10 a 50, 50 a 100 unidades. Essa √© por exemplo umas das formas usadas para harmoniza√ß√£o de dados em profundidades pr√©-definidas como √© o caso do projeto <strong>GlobalSoilMap project</strong> <span class="citation">(Arrouays et al., <a href="#ref-Arrouays2017">2017</a>)</span> que √© de 0-5, 5-15, 15-30, 30-60, 60-100, 100-200 cm.</li>
</ul>
<pre class="r"><code># Agregar cole√ß√µes de perfis de solo em ‚Äúslabs‚Äù (conjuntos) regulares
# calculando o valor m√©dio ignorando os dados ausentes
aqp::slab(sp4, fm= ~ sand + silt + clay, slab.structure=c(0,10), slab.fun=mean, na.rm=TRUE)</code></pre>
<pre><code>##   variable all.profiles value top bottom contributing_fraction
## 1     sand            1 47.63   0     10                     1
## 2     silt            1 31.15   0     10                     1
## 3     clay            1 21.11   0     10                     1</code></pre>
<pre class="r"><code># Novamente, desta vez em grupos definidos por um atributo no n√≠vel do site:
aqp::slab(sp4, fm= group ~ sand + silt + clay, slab.structure=c(0,10), slab.fun=mean, na.rm=TRUE)</code></pre>
<pre><code>##   variable group value top bottom contributing_fraction
## 1     sand     A 48.26   0     10                     1
## 2     silt     A 31.52   0     10                     1
## 3     clay     A 20.30   0     10                     1
## 4     sand     B 47.00   0     10                     1
## 5     silt     B 30.78   0     10                     1
## 6     clay     B 21.92   0     10                     1</code></pre>
<pre class="r"><code># Novamente, desta vez em v√°rias faixas de profundidade
aqp::slab(sp4, fm= ~ sand + silt + clay, slab.structure=c(0,5,15,30,60), slab.fun=mean, na.rm=TRUE)</code></pre>
<pre><code>##    variable all.profiles    value top bottom contributing_fraction
## 1      sand            1 48.54000   0      5             1.0000000
## 2      sand            1 45.96000   5     15             1.0000000
## 3      sand            1 39.29310  15     30             0.7733333
## 4      sand            1 30.36923  30     60             0.3421053
## 5      silt            1 32.40000   0      5             1.0000000
## 6      silt            1 29.15000   5     15             1.0000000
## 7      silt            1 30.37069  15     30             0.7733333
## 8      silt            1 31.00000  30     60             0.3421053
## 9      clay            1 19.00000   0      5             1.0000000
## 10     clay            1 24.79000   5     15             1.0000000
## 11     clay            1 30.20690  15     30             0.7733333
## 12     clay            1 38.38462  30     60             0.3421053</code></pre>
<pre class="r"><code># Novamente, desta vez em fatias de 1 cm, calculando quantis
agg &lt;- aqp::slab(sp4, fm= ~ sand + silt + clay)

# Agregando cole√ß√µes de perfis de solo ao longo de per√≠odos regulares ‚ÄúSlabs‚Äù
lattice::xyplot(top ~ p.q50 | variable, data=agg, ylab=&#39;Profundidade (cm)&#39;,
       xlab=&#39;Mediana delimitada pelos percentis 25 e 75&#39;,
       lower=agg$p.q25, upper=agg$p.q75, ylim=c(50,-2),
       panel=panel.depth_function,
       alpha=0.25, sync.colors=TRUE,
       par.settings=list(superpose.line=list(col=&#39;RoyalBlue&#39;, lwd=2)),
       prepanel=prepanel.depth_function,
       cf=agg$contributing_fraction, cf.col=&#39;black&#39;, cf.interval=5, 
       layout=c(3,1), strip=strip.custom(bg=grey(0.8)),
       scales=list(x=list(tick.number=4, alternating=3, relation=&#39;free&#39;))
)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="an√°lise-de-dissimilaridade-dendogramas" class="section level2">
<h2>An√°lise de Dissimilaridade (Dendogramas)</h2>
<p>Os dendogramas s√£o uma maneira conveniente de descrever a dissimilaridade entre pares (<em>pair-wise</em>), comumente associada ao t√≥pico da an√°lise de cluster.
O c√°lculo da dissimilaridade entre perfis √© realizado usando a fun√ß√£o <code>profile_compare()</code>. Os valores de dissimilaridade dependem da sele√ß√£o de atributos (por exemplo, argila, CEC, pH etc.), par√¢metro opcional de pondera√ß√£o em profundidade <code>(k)</code> e uma profundidade m√°xima de avalia√ß√£o <code>(max_d)</code>. Maiores informa√ß√µes dobre an√°lise de dissimilaridade pode ser encotrado em <span class="citation">Beaudette et al. (<a href="#ref-Beaudette2013">2013</a>)</span> e com exemplos de aplica√ß√£o em <span class="citation">Pinheiro et al. (<a href="#ref-Pinheiro2016">2016</a>)</span> e <span class="citation">Pinheiro et al. (<a href="#ref-Pinheiro2018">2018</a>)</span>.</p>
<pre class="r"><code># Dissimilaridade usando o conjunto sp4
# usando Ex-Ca:Mg e CTC a pH 7
# sem pondera√ß√£o de profundidade (k = 0)
# at√© uma profundidade m√°xima de 50 cm
d &lt;- aqp::profile_compare(sp4, vars=c(&#39;ex_Ca_to_Mg&#39;, &#39;CEC_7&#39;), k=0, max_d=50)

# Verificar matriz de dist√¢ncia
round(d, 1)</code></pre>
<pre><code>## Dissimilarities :
##                colusa glenn kings mariposa mendocino napa san benito shasta
## glenn            15.8                                                      
## kings            18.0  13.1                                                
## mariposa         17.4  20.6  25.5                                          
## mendocino        14.1   8.2  17.0     24.5                                 
## napa             33.5  24.9  30.5     39.3      22.2                       
## san benito       28.8  21.4  27.4     38.3      16.4 18.0                  
## shasta           19.2  13.6   8.7     26.6      17.6 34.8       23.3       
## shasta-trinity    8.4  16.9  22.3     18.6      17.0 30.9       28.3   23.3
## tehama           32.1  23.9  29.2     37.6      20.8  9.0       15.3   32.7
##                shasta-trinity
## glenn                        
## kings                        
## mariposa                     
## mendocino                    
## napa                         
## san benito                   
## shasta                       
## shasta-trinity               
## tehama                   29.2
## 
## Metric :  mixed ;  Types = I, I 
## Number of objects : 10</code></pre>
<pre class="r"><code># An√°lise hier√°rquica de cluster em um conjunto de dissimilaridades (Hierarchical Clustering)
h &lt;- stats::hclust(d)
# Melhor ajuste de margens
par(mar=c(4,3,2,3))

##Plotando dendrograma
plot(as.dendrogram(h))</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<pre class="r"><code>#stats::rect.hclust(h,5)

################
# Fazendo de outra forma com fun√ß√£o diana (DIvisive ANAlysis Clustering)
# vizualize a matriz de dissimilaridade via cluster hier√°rquico divisivo
d.diana &lt;- cluster::diana(d)

## Plotando Dendograma
# esta fun√ß√£o √© do pacote sharpshootR
# requer alguns ajustes manuais
par(mar=c(1,1,5,1))
sharpshootR::plotProfileDendrogram(sp4, d.diana, scaling.factor = 0.8, y.offset = 5, width=0.25, color=&#39;ex_Ca_to_Mg&#39;)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
<pre class="r"><code># solos de interesse do levatamento Americano
s.list &lt;- c(&#39;hornitos&#39;, &#39;perkins&#39;, &#39;argonaut&#39;, &#39;inks&#39;, &#39;mokelumne&#39;,
            &#39;dunstone&#39;, &#39;auburn&#39;, &#39;pentz&#39;, &#39;pardee&#39;, &#39;peters&#39;, 
            &#39;amador&#39;, &#39;laniger&#39;)

# Buscar e converter dados em um SoilProfileCollection
s &lt;- soilDB::fetchOSD(s.list)
# Estimando a profundidade do solo com base na designa√ß√£o do horizontes
s$soil.depth &lt;- profileApply(s, estimateSoilDepth, name=&#39;hzname&#39;, top=&#39;top&#39;, bottom=&#39;bottom&#39;)

# plot profiles, order by soil depth
par(mar=c(0, 0, 0, 0))
plot(s, name=&#39;hzname&#39;, plot.order=order(s$soil.depth), cex.names=0.85, axis.line.offset=-5, width=0.25, id.style=&#39;top&#39;)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-10-3.png" width="672" /></p>
<pre class="r"><code>d &lt;- SoilTaxonomyDendrogram(s, cex.taxon.labels=0.8, width=0.25, y.offset = 0.4)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-10-4.png" width="672" /></p>
</div>
</div>
<div id="parte-iii" class="section level1">
<h1>Parte III</h1>
<p>Nessa parte √© usado outra base de dados do <code>soilDB</code> s√£o eles o conjunto <code>loafercreek</code> e o conjunto <code>mineralKing</code>, e aqui al√©m de plots que marcam os horizontes diagn√≥sticos de alguns perfis √© feitos alguns plots que relacionam o perfil e a paisagem. Maiores coment√°rios estam na linha de c√≥digo</p>
<pre class="r"><code># Carregando onconjunto de dados de solos loafercreek
data(&quot;loafercreek&quot;)
# selecionar os 10 primeiros perfis
x &lt;- loafercreek[1:10, ]

#reconfigurando as margens porque o default √© muito largo
par(mar=c(1,1,2,1))

# Alguns plots
plot(x)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code>plot(x, label=&#39;pedon_id&#39;, id.style=&#39;side&#39;)
str(x)</code></pre>
<pre><code>## Formal class &#39;SoilProfileCollection&#39; [package &quot;aqp&quot;] with 8 slots
##   ..@ idcol     : chr &quot;peiid&quot;
##   ..@ hzidcol   : chr &quot;hzID&quot;
##   ..@ depthcols : chr [1:2] &quot;hzdept&quot; &quot;hzdepb&quot;
##   ..@ metadata  :&#39;data.frame&#39;:   1 obs. of  2 variables:
##   .. ..$ depth_units: chr &quot;cm&quot;
##   .. ..$ origin     : chr &quot;NASIS pedons&quot;
##   ..@ horizons  :&#39;data.frame&#39;:   62 obs. of  55 variables:
##   .. ..$ peiid               : int [1:62] 64505 64505 64505 64505 64505 64505 64505 64505 115595 115595 ...
##   .. ..$ phiid               : int [1:62] 299222 299223 299224 299225 299226 299227 299228 299229 579662 579661 ...
##   .. ..$ hzname              : chr [1:62] &quot;Oi&quot; &quot;A&quot; &quot;BAt&quot; &quot;Bt1&quot; ...
##   .. ..$ genhz               : chr [1:62] NA NA NA NA ...
##   .. ..$ hzdept              : int [1:62] 0 1 5 15 30 58 79 107 0 5 ...
##   .. ..$ hzdepb              : num [1:62] 1 5 15 30 58 79 107 108 5 10 ...
##   .. ..$ clay                : num [1:62] NA 16.7 17 19.6 23.6 ...
##   .. ..$ silt                : num [1:62] NA 46.8 48 47.4 44.7 ...
##   .. ..$ sand                : num [1:62] NA 36.5 35 33 31.7 ...
##   .. ..$ fragvoltot          : num [1:62] 0 0 0 0 0 0 0 0 0 0 ...
##   .. ..$ texture             : chr [1:62] &quot;SPM&quot; &quot;GR-L&quot; &quot;GR-L&quot; &quot;L&quot; ...
##   .. ..$ texcl               : Factor w/ 21 levels &quot;cos&quot;,&quot;s&quot;,&quot;fs&quot;,..: NA 13 13 13 13 13 NA NA 13 13 ...
##   .. ..$ lieutex             : Factor w/ 58 levels &quot;ashy&quot;,&quot;apum&quot;,..: 44 NA NA NA NA NA 47 47 NA NA ...
##   .. ..$ phfield             : num [1:62] NA 6.1 6.2 6.2 6.3 ...
##   .. ..$ effclass            : Factor w/ 5 levels &quot;very slight&quot;,..: NA NA NA NA NA NA NA NA 5 5 ...
##   .. ..$ labsampnum          : chr [1:62] NA &quot;01P1582S&quot; &quot;01P1583S&quot; &quot;01P1584S&quot; ...
##   .. ..$ rupresblkdry        : Factor w/ 11 levels &quot;loose&quot;,&quot;soft&quot;,..: NA 5 5 5 5 5 NA NA 4 4 ...
##   .. ..$ stickiness          : Factor w/ 4 levels &quot;moderately sticky&quot;,..: NA 2 2 2 3 3 NA NA 2 2 ...
##   .. ..$ plasticity          : Factor w/ 4 levels &quot;moderately plastic&quot;,..: NA 3 3 3 1 1 NA NA 3 3 ...
##   .. ..$ texture_class       : chr [1:62] &quot;spm&quot; &quot;l&quot; &quot;l&quot; &quot;l&quot; ...
##   .. ..$ d_r                 : num [1:62] NA 0.603 0.603 0.652 0.652 ...
##   .. ..$ d_g                 : num [1:62] NA 0.45 0.45 0.432 0.432 ...
##   .. ..$ d_b                 : num [1:62] NA 0.35 0.35 0.276 0.276 ...
##   .. ..$ d_hue               : chr [1:62] NA &quot;5YR&quot; &quot;5YR&quot; &quot;5YR&quot; ...
##   .. ..$ d_value             : num [1:62] NA 5 5 5 5 5 NA NA 5 5 ...
##   .. ..$ d_chroma            : num [1:62] NA 4 4 6 6 6 NA NA 4 6 ...
##   .. ..$ d_sigma             : num [1:62] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ m_r                 : num [1:62] NA 0.479 0.479 0.394 0.541 ...
##   .. ..$ m_g                 : num [1:62] NA 0.355 0.355 0.25 0.331 ...
##   .. ..$ m_b                 : num [1:62] NA 0.282 0.282 0.167 0.185 ...
##   .. ..$ m_hue               : chr [1:62] NA &quot;5YR&quot; &quot;5YR&quot; &quot;5YR&quot; ...
##   .. ..$ m_value             : num [1:62] NA 4 4 3 4 4 NA NA 4 3 ...
##   .. ..$ m_chroma            : num [1:62] NA 3 3 4 6 6 NA NA 3 4 ...
##   .. ..$ m_sigma             : num [1:62] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ moist_soil_color    : chr [1:62] NA &quot;#7A5A48&quot; &quot;#7A5A48&quot; &quot;#64402B&quot; ...
##   .. ..$ dry_soil_color      : chr [1:62] NA &quot;#9A7359&quot; &quot;#9A7359&quot; &quot;#A66E46&quot; ...
##   .. ..$ fine_gravel         : num [1:62] NA 20 25 0 0 0 NA NA NA 0 ...
##   .. ..$ gravel              : num [1:62] NA 20 25 10 20 20 NA NA NA 5 ...
##   .. ..$ cobbles             : num [1:62] NA 0 0 0 5 0 NA NA NA 0 ...
##   .. ..$ stones              : num [1:62] NA 0 0 0 0 0 NA NA NA 0 ...
##   .. ..$ boulders            : num [1:62] NA 0 0 0 0 0 NA NA NA 0 ...
##   .. ..$ channers            : num [1:62] NA 0 0 0 0 0 NA NA NA 0 ...
##   .. ..$ flagstones          : num [1:62] NA 0 0 0 0 0 NA NA NA 0 ...
##   .. ..$ parafine_gravel     : num [1:62] NA 0 0 0 0 0 NA NA NA 0 ...
##   .. ..$ paragravel          : num [1:62] NA 0 0 0 0 0 NA NA NA 0 ...
##   .. ..$ paracobbles         : num [1:62] NA 0 0 0 0 0 NA NA NA 0 ...
##   .. ..$ parastones          : num [1:62] NA 0 0 0 0 0 NA NA NA 0 ...
##   .. ..$ paraboulders        : num [1:62] NA 0 0 0 0 0 NA NA NA 0 ...
##   .. ..$ parachanners        : num [1:62] NA 0 0 0 0 0 NA NA NA 0 ...
##   .. ..$ paraflagstones      : num [1:62] NA 0 0 0 0 0 NA NA NA 0 ...
##   .. ..$ unspecified         : num [1:62] NA 0 0 0 0 0 NA NA NA 0 ...
##   .. ..$ total_frags_pct_nopf: num [1:62] 0 20 25 10 25 20 0 0 0 5 ...
##   .. ..$ total_frags_pct     : num [1:62] 0 20 25 10 25 20 0 0 0 5 ...
##   .. ..$ soil_color          : chr [1:62] NA &quot;#7A5A48&quot; &quot;#7A5A48&quot; &quot;#64402B&quot; ...
##   .. ..$ hzID                : int [1:62] 1 2 3 4 5 6 7 8 9 10 ...
##   ..@ site      :&#39;data.frame&#39;:   10 obs. of  87 variables:
##   .. ..$ peiid               : chr [1:10] &quot;64505&quot; &quot;115595&quot; &quot;115819&quot; &quot;115827&quot; ...
##   .. ..$ pedon_id            : chr [1:10] &quot;716Q&quot; &quot;300J&quot; &quot;S2000CA007009&quot; &quot;S2000CA007012&quot; ...
##   .. ..$ siteiid             : int [1:10] 64683 114622 159118 159056 209260 254459 269617 307647 308029 308033
##   .. ..$ site_id             : chr [1:10] &quot;716Q&quot; &quot;300J&quot; &quot;300J&quot; &quot;716Q&quot; ...
##   .. ..$ obs_date            : POSIXct[1:10], format: &quot;1999-08-04 04:00:00&quot; &quot;1999-06-21 04:00:00&quot; ...
##   .. ..$ utmzone             : int [1:10] 10 10 10 10 10 10 10 10 10 10
##   .. ..$ utmeasting          : num [1:10] 633987 634515 634515 633987 714162 ...
##   .. ..$ utmnorthing         : num [1:10] 4375530 4367113 4367113 4375530 4189373 ...
##   .. ..$ x                   : num [1:10] -121 -121 -121 -121 -121 ...
##   .. ..$ y                   : num [1:10] 39.5 39.4 39.4 39.5 37.8 ...
##   .. ..$ horizdatnm          : Factor w/ 25 levels &quot;NAD27&quot;,&quot;NAD83&quot;,..: 2 2 2 2 2 2 2 2 2 2
##   .. ..$ x_std               : num [1:10] -121 -121 -121 -121 -121 ...
##   .. ..$ y_std               : num [1:10] 39.5 39.4 39.4 39.5 37.8 ...
##   .. ..$ gpspositionalerror  : num [1:10] NA NA NA NA NA NA NA NA NA NA
##   .. ..$ describer           : chr [1:10] &quot;DWB&quot; &quot;Felix J. Panlasigui Jr.&quot; &quot;Felix Panlasigui&quot; &quot;DWB&quot; ...
##   .. ..$ pedonpurpose        : Factor w/ 10 levels &quot;crop yield data site&quot;,..: 4 4 4 4 4 4 4 NA 2 4
##   .. ..$ pedontype           : Factor w/ 9 levels &quot;map unit inclusion&quot;,..: 7 4 4 7 6 2 6 6 6 6
##   .. ..$ pedlabsampnum       : chr [1:10] &quot;01N0266&quot; &quot;01N0263&quot; &quot;01N0263&quot; &quot;01N0266&quot; ...
##   .. ..$ labdatadescflag     : int [1:10] 0 0 0 0 0 0 0 0 0 0
##   .. ..$ tsectstopnum        : int [1:10] NA NA NA NA 1 NA NA NA NA NA
##   .. ..$ tsectinterval       : num [1:10] NA NA NA NA 30 NA NA NA NA NA
##   .. ..$ utransectid         : logi [1:10] NA NA NA NA NA NA ...
##   .. ..$ tsectkind           : Factor w/ 2 levels &quot;random point&quot;,..: NA NA NA NA NA NA NA NA NA NA
##   .. ..$ tsectselmeth        : Factor w/ 2 levels &quot;random&quot;,&quot;biased&quot;: NA NA NA NA NA NA NA NA NA NA
##   .. ..$ elev_field          : num [1:10] 365 201 201 365 408 536 328 150 280 320
##   .. ..$ slope_field         : num [1:10] 18 8 8 18 25 45 9 NA 5 3
##   .. ..$ aspect_field        : int [1:10] 290 152 152 290 145 120 344 NA 90 238
##   .. ..$ plantassocnm        : chr [1:10] NA NA NA NA ...
##   .. ..$ earthcovkind1       : Factor w/ 10 levels &quot;artificial cover&quot;,..: NA NA NA NA NA NA NA NA NA NA
##   .. ..$ earthcovkind2       : Factor w/ 28 levels &quot;row crop&quot;,&quot;close-grown crop&quot;,..: NA NA NA NA NA NA NA NA NA NA
##   .. ..$ erocl               : Factor w/ 5 levels &quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: NA NA NA NA NA NA NA NA NA NA
##   .. ..$ bedrckdepth         : int [1:10] 107 74 74 107 73 99 64 NA NA NA
##   .. ..$ bedrckkind          : Factor w/ 157 levels &quot;sandstone, unspecified&quot;,..: 106 106 106 106 104 70 104 NA 104 104
##   .. ..$ bedrckhardness      : Factor w/ 14 levels &quot;noncemented&quot;,..: NA NA NA NA 11 10 9 NA 10 8
##   .. ..$ hillslopeprof       : Factor w/ 5 levels &quot;summit&quot;,&quot;shoulder&quot;,..: NA NA NA NA 3 3 3 NA 5 4
##   .. ..$ geomslopeseg        : Factor w/ 9 levels &quot;depression&quot;,&quot;drainageway&quot;,..: NA NA NA NA NA NA NA NA 3 NA
##   .. ..$ shapeacross         : Factor w/ 5 levels &quot;concave&quot;,&quot;linear&quot;,..: NA 1 1 NA 2 1 1 NA 2 NA
##   .. ..$ shapedown           : Factor w/ 5 levels &quot;concave&quot;,&quot;linear&quot;,..: NA NA NA NA 2 2 3 NA 3 NA
##   .. ..$ slopecomplex        : Factor w/ 2 levels &quot;complex&quot;,&quot;simple&quot;: NA NA NA NA NA 2 2 NA 2 NA
##   .. ..$ drainagecl          : Factor w/ 8 levels &quot;excessively&quot;,..: 3 NA NA 3 3 3 3 NA 3 NA
##   .. ..$ geomposhill         : Factor w/ 8 levels &quot;interfluve&quot;,&quot;head slope&quot;,..: NA NA NA NA 4 4 4 NA 1 NA
##   .. ..$ geomposmntn         : Factor w/ 7 levels &quot;mountaintop&quot;,..: NA NA NA NA NA NA NA NA NA NA
##   .. ..$ geomposflats        : Factor w/ 4 levels &quot;flat&quot;,&quot;dip&quot;,&quot;rise&quot;,..: NA NA NA NA NA NA NA NA NA NA
##   .. ..$ slope_shape         : Factor w/ 9 levels &quot;convex / convex&quot;,..: NA NA NA NA 5 8 7 NA 4 NA
##   .. ..$ classdate           : POSIXct[1:10], format: &quot;2012-07-24 04:02:15&quot; &quot;2012-07-24 04:02:22&quot; ...
##   .. ..$ classifier          : chr [1:10] NA NA NA NA ...
##   .. ..$ classtype           : Factor w/ 4 levels &quot;correlated&quot;,&quot;field&quot;,..: 1 1 1 1 1 1 1 1 1 1
##   .. ..$ taxonname           : chr [1:10] &quot;LOAFERCREEK&quot; &quot;LOAFERCREEK&quot; &quot;LOAFERCREEK&quot; &quot;Loafercreek&quot; ...
##   .. ..$ localphase          : chr [1:10] NA NA NA NA ...
##   .. ..$ taxonkind           : Factor w/ 6 levels &quot;family&quot;,&quot;taxon above family&quot;,..: 4 4 4 4 4 4 4 4 4 4
##   .. ..$ seriesstatus        : Factor w/ 3 levels &quot;tentative&quot;,&quot;established&quot;,..: NA NA NA NA NA NA NA NA 2 1
##   .. ..$ taxpartsize         : Factor w/ 113 levels &quot;unclassified&quot;,..: 54 54 54 54 54 54 54 54 54 54
##   .. ..$ taxorder            : Factor w/ 12 levels &quot;alfisols&quot;,&quot;andisols&quot;,..: 1 1 1 1 1 1 1 1 1 1
##   .. ..$ taxsuborder         : Factor w/ 81 levels &quot;aqualfs&quot;,&quot;boralfs&quot;,..: 5 5 5 5 5 5 5 5 5 5
##   .. ..$ taxgrtgroup         : Factor w/ 459 levels &quot;albaqualfs&quot;,&quot;duraqualfs&quot;,..: 38 38 38 38 38 38 38 38 38 38
##   .. ..$ taxsubgrp           : Factor w/ 3764 levels &quot;typic albaqualfs&quot;,..: 270 270 257 270 270 270 270 270 270 270
##   .. ..$ soiltaxedition      : Factor w/ 12 levels &quot;first edition&quot;,..: 8 8 8 9 12 10 10 11 12 12
##   .. ..$ osdtypelocflag      : int [1:10] 0 0 0 0 0 0 0 0 0 0
##   .. ..$ taxmoistcl          : Factor w/ 7 levels &quot;aquic&quot;,&quot;aridic (torric)&quot;,..: 7 7 7 7 7 NA 7 7 7 7
##   .. ..$ taxtempregime       : Factor w/ 13 levels &quot;cryic&quot;,&quot;frigid&quot;,..: 10 10 10 10 10 10 10 10 10 10
##   .. ..$ taxfamother         : Factor w/ 13 levels &quot;not used&quot;,&quot;coated&quot;,..: 1 NA NA 1 1 1 NA NA NA NA
##   .. ..$ psctopdepth         : int [1:10] 15 10 10 15 13 48 23 NA 30 28
##   .. ..$ pscbotdepth         : int [1:10] 66 61 61 65 63 94 64 NA 58 61
##   .. ..$ selection_method    : chr [1:10] &quot;most recent&quot; &quot;most recent&quot; &quot;most recent&quot; &quot;most recent&quot; ...
##   .. ..$ ecositeid           : chr [1:10] NA NA NA NA ...
##   .. ..$ ecositenm           : chr [1:10] NA NA NA NA ...
##   .. ..$ ecositecorrdate     : POSIXct[1:10], format: NA NA ...
##   .. ..$ es_classifier       : chr [1:10] NA NA NA NA ...
##   .. ..$ es_selection_method : chr [1:10] NA NA NA NA ...
##   .. ..$ ochric.epipedon     : logi [1:10] TRUE TRUE TRUE TRUE TRUE TRUE ...
##   .. ..$ argillic.horizon    : logi [1:10] TRUE TRUE TRUE TRUE TRUE TRUE ...
##   .. ..$ paralithic.contact  : logi [1:10] TRUE TRUE TRUE TRUE TRUE TRUE ...
##   .. ..$ lithic.contact      : logi [1:10] TRUE FALSE FALSE TRUE FALSE FALSE ...
##   .. ..$ cambic.horizon      : logi [1:10] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. ..$ paralithic.materials: logi [1:10] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. ..$ surface_fgravel     : num [1:10] 0 0 0 0 0 0 0 0 0 0
##   .. ..$ surface_gravel      : num [1:10] 5 0 0 0 5 0 0 0 0 0
##   .. ..$ surface_cobbles     : num [1:10] 2 0 0 0 0 0 0 0 0 0
##   .. ..$ surface_stones      : num [1:10] 2 0 0 0 0 0 0 0 0 0
##   .. ..$ surface_boulders    : num [1:10] 0 0 0 0 0 0 0 0 0 0
##   .. ..$ surface_channers    : num [1:10] 0 0 0 0 0 0 0 0 0 0
##   .. ..$ surface_flagstones  : num [1:10] 0 0 0 0 0 0 0 0 0 0
##   .. ..$ surface_paragravel  : num [1:10] 0 0 0 0 0 0 0 0 0 0
##   .. ..$ surface_paracobbles : num [1:10] 0 0 0 0 0 0 0 0 0 0
##   .. ..$ landform_string     : chr [1:10] NA NA NA NA ...
##   .. ..$ pmkind              : chr [1:10] &quot;residuum&quot; &quot;residuum&quot; &quot;residuum&quot; &quot;residuum&quot; ...
##   .. ..$ pmorigin            : chr [1:10] &quot;metavolcanics&quot; &quot;metavolcanics&quot; &quot;metavolcanics&quot; &quot;metavolcanics&quot; ...
##   ..@ sp        :Formal class &#39;SpatialPoints&#39; [package &quot;sp&quot;] with 3 slots
##   .. .. ..@ coords     : num [1, 1] 0
##   .. .. ..@ bbox       : logi [1, 1] NA
##   .. .. ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
##   .. .. .. .. ..@ projargs: chr NA
##   ..@ diagnostic:&#39;data.frame&#39;:   30 obs. of  4 variables:
##   .. ..$ peiid   : int [1:30] 64505 64505 64505 64505 115595 115595 115595 115819 115819 115819 ...
##   .. ..$ featkind: Factor w/ 84 levels &quot;anthropic epipedon&quot;,..: 23 32 35 18 23 32 35 23 32 35 ...
##   .. ..$ featdept: int [1:30] 1 15 79 107 0 10 74 0 10 74 ...
##   .. ..$ featdepb: int [1:30] 5 79 107 NA 10 74 81 10 74 81 ...</code></pre>
<pre class="r"><code># Adicionar marca√ß√£o para alguns horizontes diagn√≥sticos
addDiagnosticBracket(x, kind=&#39;argillic horizon&#39;, col=&#39;red&#39;)
addDiagnosticBracket(x, kind=&#39;paralithic contact&#39;, col=&#39;black&#39;)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-11-2.png" width="672" /></p>
<pre class="r"><code># Agrupar perfis pela posi√ß√£o na paisagem
groupedProfilePlot(x, groups=&#39;hillslopeprof&#39;, label=&#39;pedon_id&#39;, id.style=&#39;side&#39;)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-11-3.png" width="672" /></p>
<pre class="r"><code># Carregando onconjunto de dados de solos mineralKing
data(&quot;mineralKing&quot;)
par(mar=c(1,1,2,1))
groupedProfilePlot(mineralKing, groups=&#39;taxonname&#39;, print.id=FALSE)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-11-4.png" width="672" /></p>
<pre class="r"><code># plot de dist√¢ncia ao longo de um transecto
coordinates(mineralKing) &lt;- ~ x_std + y_std
# defina o sistema de coordenada de refer√™ncia (CRS)
proj4string(mineralKing) &lt;- &#39;+proj=longlat +datum=NAD83&#39;
crs.utm &lt;- CRS(&#39;+proj=utm +zone=11 +datum=NAD83&#39;) #reprojetando para utm metros
par(mar=c(4.5,4,1,1))

# plot Padr√£o
plotTransect(mineralKing, grad.var.name = &#39;elev_field&#39;, crs = crs.utm)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-11-5.png" width="672" /></p>
<pre class="r"><code># plot com altera√ß√£o de tamanho e tipo de fonte e nome dos eixos
plotTransect(mineralKing, grad.var.name=&#39;elev_field&#39;, crs=crs.utm, grad.axis.title=&#39;Eleva√ß√£o (m)&#39;, 
             distance.axis.title=&#39;Dist√¢ncia ao longo do transecto (km)&#39;,
             label=&#39;pedon_id&#39;, scaling.factor = 0.5,
             cex.names=0.8,cex.id=0.8,col.legend.cex=1.5,family=&quot;serif&quot;)</code></pre>
<p><img src="/post/tools/index_files/figure-html/unnamed-chunk-11-6.png" width="672" />
### Se voc√™ chegou at√© aqui muito bem !!!! üëèüëèüëè</p>
</div>
<div id="refer√™ncias" class="section level1 unnumbered">
<h1>Refer√™ncias</h1>
<div id="refs" class="references">
<div id="ref-Arrouays2017">
<p>Arrouays, D., Leenaars, J.G.B., Richer-de-Forges, A.C., Adhikari, K., Ballabio, C., Greve, M., Grundy, M., Guerrero, E., Hempel, J., Hengl, T., Heuvelink, G., Batjes, N., Carvalho, E., Hartemink, A., Hewitt, A., Hong, S.Y., Krasilnikov, P., Lagacherie, P., Lelyk, G., Libohova, Z., Lilly, A., McBratney, A., McKenzie, N., Vasquez, G.M., Mulder, V.L., Minasny, B., Montanarella, L., Odeh, I., Padarian, J., Poggio, L., Roudier, P., Saby, N., Savin, I., Searle, R., Solbovoy, V., Thompson, J., Smith, S., Sulaeman, Y., Vintila, R., Rossel, R.V., Wilson, P., Zhang, G.L., Swerts, M., Oorts, K., Karklins, A., Feng, L., Ibelles Navarro, A.R., Levin, A., Laktionova, T., Dell‚ÄôAcqua, M., Suvannang, N., Ruam, W., Prasad, J., Patil, N., Husnjak, S., P√°sztor, L., Okx, J., Hallet, S., Keay, C., Farewell, T., Lilja, H., Juilleret, J., Marx, S., Takata, Y., Kazuyuki, Y., Mansuy, N., Panagos, P., Van Liedekerke, M., Skalsky, R., Sobocka, J., Kobza, J., Eftekhari, K., Alavipanah, S.K., Moussadek, R., Badraoui, M., Da Silva, M., Paterson, G., Gon√ßalves, M. da C., Theocharopoulos, S., Yemefack, M., Tedou, S., Vrscaj, B., Grob, U., Koz√°k, J., Boruvka, L., Dobos, E., Taboada, M., Moretti, L., Rodriguez, D., 2017. Soil legacy data rescue via GlobalSoilMap and other international and national initiatives. GeoResJ 14, 1‚Äì19. <a href="https://doi.org/10.1016/j.grj.2017.06.001">https://doi.org/10.1016/j.grj.2017.06.001</a></p>
</div>
<div id="ref-Beaudette2013">
<p>Beaudette, D.E., Roudier, P., O‚ÄôGeen, A.T., 2013. Algorithms for quantitative pedology: A toolkit for soil scientists. Computers and Geosciences 52, 258‚Äì268. <a href="https://doi.org/10.1016/j.cageo.2012.10.020">https://doi.org/10.1016/j.cageo.2012.10.020</a></p>
</div>
<div id="ref-Pinheiro2016">
<p>Pinheiro, H.S.K., Chagas, C. da S., Carvalho Junior, W., Anjos, L.H.C., 2016. Ferramentas de pedometria para caracteriza√ß√£o da composi√ß√£o granulom√©trica de perfis de solos hidrom√≥rficos. Pesquisa Agropecu√°ria Brasileira 51, 1326‚Äì1338. <a href="https://doi.org/10.1590/S0100-204X2016000900032">https://doi.org/10.1590/S0100-204X2016000900032</a></p>
</div>
<div id="ref-Pinheiro2018">
<p>Pinheiro, H.S.K., Helena, L., Anjos, C., Xavier, P.A.M., Cesar, S., 2018. Quantitative pedology to evaluate a soil profile collection from the Brazilian semi-arid region. South African Journal of Geomatics 1862, 1‚Äì11. <a href="https://doi.org/10.1080/02571862.2017.1419385">https://doi.org/10.1080/02571862.2017.1419385</a></p>
</div>
<div id="ref-R2019">
<p>R Core Team, 2019. R: A Language and Environment for Statistical Computing.</p>
</div>
</div>
</div>
