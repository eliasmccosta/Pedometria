---
date: "2020-06-02"
diagram: true
image:
  caption: 'Image credit: [**Elias**](https://www.instagram.com/eliasmendescosta/)'
  focal_point: ""
  placement: 3
math: true
title: Ferramenta pedometricas
subtitle: 'Ferramenta pedometricas para an√°lises de pedologia quantitativa'
summary: ''
bibliography: [references.bib]
link-citations: true 
csl: [geoderma-regional.csl]
authors:
- admin
categories:
  - R
  - Programa√ß√£o
tags:
  - MDS
  - Pedometria
nocite: | 
  @R-bookdown
---



<div id="introdu√ß√£o" class="section level1">
<h1>Introdu√ß√£o</h1>
<p>Nesse tutorial ser√£o abordados atrav√©s do Algoritmos para Pedologia Quantitativa (AQP em ingl√™s) e pacotes auxiliares uma cole√ß√£o de c√≥digos, ideias, e plotes usando o software R <span class="citation">(<span class="citeproc-not-found" data-reference-id="2019"><strong>???</strong></span>)</span>. Toda a teoria por tr√°s de grande parte do c√≥digo pode ser encontrada no artigo <a href="https://www.sciencedirect.com/science/article/pii/S009830041200369X?via%3Dihub"><em>Algorithms for quantitative pedology: A toolkit for soil scientists</em></a> <span class="citation">(Beaudette et al., <a href="#ref-Beaudette2013">2013</a>)</span>. Al√©m disso artigos disso alguns exemplos de aplica√ß√µes das ferramentas podem se encontrados em <span class="citation">Pinheiro et al. (<a href="#ref-Pinheiro2016">2016</a>)</span> e <span class="citation">Pinheiro et al. (<a href="#ref-Pinheiro2018">2018</a>)</span>. Para fins did√°ticos o tutorial foi dividido em tr√™s partes e os pacotes usados ser√£o <em>soilDB</em>, que contem uma base de dados de solos para an√°lises pedom√©tricas, <em>AQP</em> que contem as principais ferramentas de pedologia quantitativa usadas no tutorial, <em>sharpshootR</em> que contem uma coel√ß√£o de fun√ß√µes que d√£o suporte ao levantamento e explora√ß√£o de dados de solos, <em>SP</em> um pacote que fornece classes e m√©todos para dados espaciais: pontos, linhas, pol√≠gonos e grades, <em>Hmisc</em> que cont√©m muitas fun√ß√µes √∫teis para an√°lise de dados, gr√°ficos de alto n√≠vel, opera√ß√µes utilit√°rias, fun√ß√µes para calcular o tamanho de amostras, importar e manipular conjuntos de dados, imputar valores ausentes, cria√ß√£o avan√ßada de tabelas, an√°lise de cluster entre outras fun√ß√µes, <em>lattice</em> que √© um sistema de visualiza√ß√£o de dados de alto n√≠vel, poderoso e elegante, com √™nfase em dados multivariados, <em>MASS</em> com fun√ß√µes e conjuntos de dados para apoiar Venables e Ripley, <strong>Modern Applied Statistics with S</strong> e <em>plyr</em> que contem um conjunto de ferramentas que resolve problemas tais como: Divis√£o, aplica√ß√£o e combina√ß√£o de dados.</p>
<div id="base-de-dados-dos-exerc√≠cios" class="section level2">
<h2>Base de dados dos exerc√≠cios</h2>
<p>Todos os dados usados nos exerc√≠cios ou s√£o do pacote <em>AQP</em> ou s√£o do pacote <em>soilDB</em>. Muitas das informa√ß√µes contidas nesse nesse tutorial foram extra√≠das do <a href="http://ncss-tech.github.io/AQP/">projeto do AQP</a></p>
<pre class="r"><code># Carregando os pacotes no R
library(soilDB) 
library(aqp)  
library(sharpshootR) 
library(sp) 
library(Hmisc)
library(lattice)
library(MASS)
library(plyr)</code></pre>
</div>
</div>
<div id="parte-i" class="section level1">
<h1>Parte I</h1>
<p>Na parte I ser√£o abordadas caracter√≠sticas das fun√ß√µes b√°sicas do <em>AQP</em>, conceito de cole√ß√£o de perfis de solos, <strong>SoilProfileCollection</strong>, e verifica√ß√£o da estrutura de dados na cole√ß√£o, al√©m de alguns plotes b√°sicos.
A classe <strong>SoilProfileCollection</strong> foi projetada para simplificar o processo de trabalhar com a cole√ß√£o de dados associados aos perfis de solo: dados em n√≠vel de local (site), dados em n√≠vel de horizonte, dados espaciais, dados de horizontes de diagn√≥sticos, metadados, etc. Os exemplos listados abaixo devem ser copiados/colados deste documento e executados de forma interativa em R. Lembrando que antes de execultar voc√™ deve instalar e carregar todas as bibliot√©cas (pacotes) mencionados.</p>
<div id="cria√ß√£o-de-objetos" class="section level2">
<h2>Cria√ß√£o de Objetos</h2>
<p>Os objetos <strong>SoilProfileCollection</strong> geralmente s√£o criados pela atrav√©s de objetos <em>data.frame</em> (tabelas retangulares de dados) que cont√™m pelo menos tr√™s colunas essenciais:
- Uma coluna de identifica√ß√£o que identifica exclusivamente grupos de horizontes (por exemplo, <em>pedons</em>)
- Limites superiores do horizonte
- Limites inferiores do horizonte
O <em>data.frame</em> deve ser pr√©-classificado de acordo com o ID do perfil e o limite superior do horizonte. A nota√ß√£o de f√≥rmula √© usada para definir as colunas usadas para promover um objeto <em>data.frame</em>.</p>
<pre class="r"><code># Carregando dados de solos
# upgrade para SoilProfileCollection
# &#39;id&#39; √© o nome da coluna que cont√©m o ID do perfil
# &#39;top&#39; √© o nome da coluna que cont√©m os limites superiores do horizonte
# &#39;bottom&#39; √© o nome da coluna que cont√©m os limites inferiores do horizonte
data(sp1) # Conjunto de dados sp1 do pacote AQP (data.frame)
aqp::depths(sp1) &lt;- id ~ top + bottom 
aqp::site(sp1) &lt;- ~ group </code></pre>
</div>
<div id="acessando-configurando-e-substituindo-dados" class="section level2">
<h2>Acessando, configurando e substituindo dados</h2>
<p>As fun√ß√µes de acesar s√£o usadas para extrair componentes espec√≠ficos dos objetos <strong>SoilProfileCollection</strong>.</p>
<pre class="r"><code># M√©todos para inpens√£o dos objetos
idname (sp1) # auto-explicativo</code></pre>
<pre><code>## [1] &quot;id&quot;</code></pre>
<pre class="r"><code>horizonDepths(sp1) # auto-explicativo</code></pre>
<pre><code>## [1] &quot;top&quot;    &quot;bottom&quot;</code></pre>
<pre class="r"><code>depth_units(sp1) # defaults &#39;cm&#39;</code></pre>
<pre><code>## [1] &quot;cm&quot;</code></pre>
<pre class="r"><code>metadata(sp1) # </code></pre>
<pre><code>##   depth_units
## 1          cm</code></pre>
<pre class="r"><code>profile_id(sp1) # vector com IDs dos perfis</code></pre>
<pre><code>## [1] &quot;P001&quot; &quot;P002&quot; &quot;P003&quot; &quot;P004&quot; &quot;P005&quot; &quot;P006&quot; &quot;P007&quot; &quot;P008&quot; &quot;P009&quot;</code></pre>
<pre class="r"><code>horizonNames(sp1) # coluna com osnomes dos dados dos horizontes</code></pre>
<pre><code>##  [1] &quot;id&quot;               &quot;top&quot;              &quot;bottom&quot;           &quot;bound_distinct&quot;  
##  [5] &quot;bound_topography&quot; &quot;name&quot;             &quot;texture&quot;          &quot;prop&quot;            
##  [9] &quot;structure_grade&quot;  &quot;structure_size&quot;   &quot;structure_type&quot;   &quot;stickiness&quot;      
## [13] &quot;plasticity&quot;       &quot;field_ph&quot;         &quot;hue&quot;              &quot;value&quot;           
## [17] &quot;chroma&quot;           &quot;hzID&quot;</code></pre>
<pre class="r"><code>siteNames(sp1) # coluna com os nomes do dados dos locais (site data)</code></pre>
<pre><code>## [1] &quot;id&quot;    &quot;group&quot;</code></pre>
<pre class="r"><code>length(sp1) # n√∫mero de perfis na cole√ß√£o</code></pre>
<pre><code>## [1] 9</code></pre>
<pre class="r"><code>nrow(sp1) # n√∫mero de horizontes na cole√ß√£o</code></pre>
<pre><code>## [1] 60</code></pre>
<pre class="r"><code>names(sp1) # nomes de colunas dos dados do site e do horizonte, concatenados em um √∫nico vetor</code></pre>
<pre><code>##          horizons1          horizons2          horizons3          horizons4 
##               &quot;id&quot;              &quot;top&quot;           &quot;bottom&quot;   &quot;bound_distinct&quot; 
##          horizons5          horizons6          horizons7          horizons8 
## &quot;bound_topography&quot;             &quot;name&quot;          &quot;texture&quot;             &quot;prop&quot; 
##          horizons9         horizons10         horizons11         horizons12 
##  &quot;structure_grade&quot;   &quot;structure_size&quot;   &quot;structure_type&quot;       &quot;stickiness&quot; 
##         horizons13         horizons14         horizons15         horizons16 
##       &quot;plasticity&quot;         &quot;field_ph&quot;              &quot;hue&quot;            &quot;value&quot; 
##         horizons17         horizons18               site 
##           &quot;chroma&quot;             &quot;hzID&quot;            &quot;group&quot;</code></pre>
<pre class="r"><code>min(sp1) # profundidade de perfil mais raso da cole√ß√£o</code></pre>
<pre><code>## [1] 59</code></pre>
<pre class="r"><code>max(sp1) # profundidade de perfil mais profundo da cole√ß√£o</code></pre>
<pre><code>## [1] 240</code></pre>
</div>
<div id="dados-do-horizonte-e-do-site-local" class="section level2">
<h2>Dados do horizonte e do site (local)</h2>
<p>Normalmente, os dados do horizonte e do site s√£o os componentes mais importantes dos objetos SoilProfileCollection. Ambos s√£o armazenados internamente como objetos data.frame; com uma ou mais linhas (por ID do perfil) na tabela do horizonte e uma linha (por ID do perfil) na tabela do site. As colunas de qualquer tabela podem ser acessadas com a nota√ß√£o <em>$</em>. Novos dados podem ser atribu√≠dos a qualquer tabela da mesma maneira, desde que o comprimento dos novos dados seja:
- Mesmo tamanho que o n√∫mero de perfis na cole√ß√£o (o destino √© a tabela de sites).
- Mesmo comprimento que o n√∫mero de horizontes na cole√ß√£o (o destino √© a tabela do horizonte).</p>
</div>
<div id="plotando-soilprofilecollection" class="section level2">
<h2>Plotando <strong>SoilProfileCollection</strong></h2>
<p>O m√©todo <em>plot()</em> para objetos <strong>SoilProfileCollection</strong> gera esbo√ßos de perfis na cole√ß√£o com base nos limites dos horizontes, alinhados verticalmente a uma sequ√™ncia inteira de 1 ao n√∫mero de perfis. Os nomes dos horizontes s√£o extra√≠dos automaticamente de um nome de atributo no n√≠vel do horizonte (se presente) ou por meio de um atributo alternativo fornecido como argumento: <em>name = ‚Äònomedacoula‚Äô</em>. As cores do horizonte s√£o geradas automaticamente a partir do atributo no n√≠vel do horizonte <em>soil_color</em>, ou qualquer outro atributo da descri√ß√£o de cor compat√≠vel com R, fornecido como argumento: <em>color = ‚Äònomedacoula‚Äô</em>. Essa fun√ß√£o √© altamente personaliz√°vel; portanto, √© prudente consultar a ajuda <em>(plotSPC)</em> de tempos em tempos. As cores do solo na nota√ß√£o Munsell podem ser convertidas em cores compat√≠veis com R via <em>munsell2rgb()</em>.</p>
<pre class="r"><code>data(sp4) # Conjunto de dados sp4 do pacote AQP (data.frame)
aqp::depths(sp4) &lt;- id ~ top + bottom 
# Atribui√ß√£o de novos dados a atributos existentes ou novos
sp4$elevation &lt;- rnorm(n=length(sp4), mean=1000, sd=150) # no n√≠vel do site, com base no comprimento dos dados atribu√≠dos
sp4$thickness &lt;- sp4$bottom - sp4$top # n√≠vel do horizonte
# Extra√ß√£o de atributos espec√≠ficos por nome
sp4$clay # Vetor de conte√∫do de argila (dados do horizonte)</code></pre>
<pre><code>##  [1] 21 27 32 55 25 34  3 15 27 32 25 31 33 13 21 23 15 17 12 19 14 14 22 25 40
## [26] 51 67 24 25 32</code></pre>
<p>Os dados do horizonte e do local (site) tamb√©m podem ser modificados por extra√ß√£o para um data.frame, seguidos pela substitui√ß√£o (dados do horizonte) ou jun√ß√£o (dados do site). Observe que, embora essa abordagem ofere√ßa a maior flexibilidade, ela tamb√©m √© a mais perigosa - a substitui√ß√£o dos dados do horizonte por novos dados que n√£o est√£o exatamente de acordo com a classifica√ß√£o original pode corromper seu <strong>SoilProfileCollection</strong>.</p>
<pre class="r"><code># extrair dados os horizontes para o data.frame
h &lt;- horizons(sp4)
# Adicionar uma nova coluna e salvar de volta no objeto
h$random.numbers &lt;- rnorm(n=nrow(h), mean=0, sd=1)
# repor dados originais dos horizontes com vers√£o modificada
#!a ordem das linhas n√£o deve ser alterada!
horizons(sp4) &lt;- h
# extrair dados do site para o data.frame
s &lt;- site(sp4)
# Adicionar um grupo para o site fake
s$group &lt;- factor(rep(c(&#39;A&#39;, &#39;B&#39;), length.out=nrow(s)))
# junte novos dados do site com dados anteriores: os dados antigos n√£o s√£o substitu√≠dos
site(sp4) &lt;- s
# Verificar
sp4</code></pre>
<pre><code>## Object of class SoilProfileCollection
## Number of profiles: 10
## Depth range: 16-49 cm
## 
## Horizon attributes:
##       id name top bottom   K   Mg  Ca CEC_7 ex_Ca_to_Mg sand silt clay   CF
## 1 colusa    A   0      3 0.3 25.7 9.0  23.0        0.35   46   33   21 0.12
## 2 colusa  ABt   3      8 0.2 23.7 5.6  21.4        0.23   42   31   27 0.27
## 3 colusa  Bt1   8     30 0.1 23.2 1.9  23.7        0.08   40   28   32 0.27
## 4 colusa  Bt2  30     42 0.1 44.3 0.3  43.0        0.01   27   18   55 0.16
## 5  glenn    A   0      9 0.2 21.9 4.4  18.8        0.20   54   20   25 0.55
## 6  glenn   Bt   9     34 0.3 18.9 4.5  27.5        0.20   49   18   34 0.84
##   hzID thickness random.numbers
## 1    1         3    -2.01278170
## 2    2         5     0.02852967
## 3    3        22     0.62486568
## 4    4        12     2.28256707
## 5    5         9     1.07620296
## 6    6        25    -2.26869533
## 
## Sampling site attributes:
##          id elevation group
## 1    colusa  810.9684     A
## 2     glenn 1043.7407     B
## 3     kings 1393.9292     A
## 4  mariposa 1216.2948     B
## 5 mendocino 1226.2206     A
## 6      napa  754.1708     B</code></pre>
<pre class="r"><code># Fazendo um plot simples
plot(sp4, name=&#39;name&#39;)
# title, note line argument:
title(&#39;Perfis de Solo&#39;, line=1, cex.main=0.75)
# profiles are centered at integers, from 1 to length(obj)
axis(1, line=0, at=1:15, cex.axis=0.75, font=4, col=&#39;blue&#39;, col.axis=&#39;blue&#39;, lwd=2)
mtext(&#39;Perfis&#39;, side=1, line=2, font=4, col=&#39;blue&#39;)
# y-axis is based on profile depths
axis(2, line=-1, at=pretty(1:max(sp4)), cex.axis=0.75, font=4, las=1, col=&#39;blue&#39;, col.axis=&#39;blue&#39;, lwd=2)
mtext(&#39;Profundidade&#39;, side=2, line=1, font=4, col=&#39;blue&#39;)</code></pre>
<p><img src="/post/pedometrics_tools/index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code># plot com separa√ß√£o de grupos
aqp::groupedProfilePlot(sp4, groups=&#39;group&#39;, max.depth=240, group.name.offset = -5, id.style=&#39;side&#39;)</code></pre>
<p><img src="/post/pedometrics_tools/index_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<pre class="r"><code># Esbo√ßos Tem√°ticos

sp4$clay # </code></pre>
<pre><code>##  [1] 21 27 32 55 25 34  3 15 27 32 25 31 33 13 21 23 15 17 12 19 14 14 22 25 40
## [26] 51 67 24 25 32</code></pre>
<pre class="r"><code>par(mar=c(1,1,3,1)) # tighter figure margins
plot(sp4, name=&#39;name&#39;, color=&#39;clay&#39;,cex.names=0.5,cex.id=0.5, id.style=&#39;top&#39;,col.legend.cex=1,family=&quot;serif&quot;, col.label=&#39;Argila&#39;, )</code></pre>
<p><img src="/post/pedometrics_tools/index_files/figure-html/unnamed-chunk-7-3.png" width="672" /></p>
<pre class="r"><code>sp4$Ca # </code></pre>
<pre><code>##  [1]  9.0  5.6  1.9  0.3  4.4  4.5  1.4  7.0  4.4  5.8  6.2  6.2  4.4  2.2  3.4
## [16]  3.7 24.1 21.5  0.7  5.6  3.5  2.0  6.6  4.1  3.5  1.5  0.8 16.3 16.5 13.7</code></pre>
<pre class="r"><code>par(mar=c(1,1,3,1)) # tighter figure margins
plot(sp4, name=&#39;name&#39;, color=&#39;Ca&#39;,cex.names=0.5,cex.id=0.5, id.style=&#39;top&#39;,col.legend.cex=1,
     col.label=&#39;Ca&#39;, family=&quot;serif&quot;)</code></pre>
<p><img src="/post/pedometrics_tools/index_files/figure-html/unnamed-chunk-7-4.png" width="672" /></p>
<pre class="r"><code>sp4$name # </code></pre>
<pre><code>##  [1] &quot;A&quot;   &quot;ABt&quot; &quot;Bt1&quot; &quot;Bt2&quot; &quot;A&quot;   &quot;Bt&quot;  &quot;A&quot;   &quot;Bt1&quot; &quot;Bt2&quot; &quot;A&quot;   &quot;Bt1&quot; &quot;Bt2&quot;
## [13] &quot;Bt3&quot; &quot;A&quot;   &quot;Bt1&quot; &quot;Bt2&quot; &quot;A&quot;   &quot;Bt&quot;  &quot;A&quot;   &quot;Bt&quot;  &quot;A&quot;   &quot;Bt&quot;  &quot;A1&quot;  &quot;A2&quot; 
## [25] &quot;AB&quot;  &quot;Bt1&quot; &quot;Bt2&quot; &quot;A&quot;   &quot;Bt1&quot; &quot;Bt2&quot;</code></pre>
<pre class="r"><code>par(mar=c(2,2,3,2)) # tighter figure margins
plot(sp4, name=&#39;name&#39;, color=&#39;name&#39;, col.palette=RColorBrewer::brewer.pal(9, &#39;Set1&#39;), col.label=&#39;Nomes do Horizontes&#39;, 
     cex.names=0.5)</code></pre>
<p><img src="/post/pedometrics_tools/index_files/figure-html/unnamed-chunk-7-5.png" width="672" /></p>
<pre class="r"><code>###############
### Boxplot ###
# Aqui usaremos o conjunto sp1
sp1$name1 &lt;- generalize.hz(sp1$name, 
                           new=c(&#39;A&#39;,&#39;AB&#39;, &#39;BA&#39;,&#39;B&#39;,&#39;BC&#39;, &#39;C&#39;, &#39;E&#39;, &#39;AE&#39;, &#39;O&#39;, &#39;H&#39;, &#39;R&#39;, &#39;2C&#39;, &#39;3C&#39;, &#39;3B&#39;, &#39;3A&#39;), 
                           pat=c(&#39;^A&#39;,&#39;^AB&#39;,&#39;^BA&#39;,&#39;^B&#39;,&#39;^BC&#39;,&#39;^C&#39;, &#39;^E&#39;, &#39;^AE&#39;, &#39;^O&#39;, &#39;^H&#39;, &#39;^R&#39;, &#39;^2C&#39;, &#39;^3C&#39;,&#39;^3B&#39;, &#39;^3A&#39; ))

# compute horizon mid-points 
sp1$mid &lt;- with(horizons(sp1), (top+ bottom)/2)
# sort horizon designation by group-wise median values 
hz.designation.by.median.depths &lt;- names(sort(tapply(sp1$mid, sp1$name1, median)))
# plot the distribution of horizon mid-points by designation 
bwplot(mid ~ factor(name, levels=hz.designation.by.median.depths),
       data=horizons(sp1),       
       ylim=c(200, 0), ylab=&#39;Profundidade do ponto m√©dio do horizonte (cm)&#39;,       
       scales=list(y=list(tick.number=10)),       
       panel= function ( ... ) {
         panel.abline(h=seq(0, 180, by=10), v=1:length(hz.designation.by.median.depths), col=grey(0.8), lty=3)    
         panel.bwplot( ... ) })</code></pre>
<p><img src="/post/pedometrics_tools/index_files/figure-html/unnamed-chunk-7-6.png" width="672" /></p>
<pre class="r"><code>bwplot(prop~ factor(name1, levels=hz.designation.by.median.depths),
       data=horizons(sp1),       
       ylab=&#39;Profundidade&#39;,       
       scales=list(y=list(tick.number=10)),       
       panel= function ( ... ) {  
         panel.abline(h=seq(0, 600, by=50), v=1:length(hz.designation.by.median.depths), col=grey(0.8), lty=3)  
         panel.bwplot( ... ) })</code></pre>
<p><img src="/post/pedometrics_tools/index_files/figure-html/unnamed-chunk-7-7.png" width="672" /></p>
<div id="se-voc√™-chegou-at√©-aqui-muito-bem" class="section level3">
<h3>Se voc√™ chegou at√© aqui muito bem !!!! üëèüëèüëè</h3>
</div>
</div>
</div>
<div id="refer√™ncias" class="section level1 unnumbered">
<h1>Refer√™ncias</h1>
<div id="refs" class="references">
<div id="ref-Beaudette2013">
<p>Beaudette, D.E., Roudier, P., O‚ÄôGeen, A.T., 2013. Algorithms for quantitative pedology: A toolkit for soil scientists. Computers and Geosciences 52, 258‚Äì268. <a href="https://doi.org/10.1016/j.cageo.2012.10.020">https://doi.org/10.1016/j.cageo.2012.10.020</a></p>
</div>
<div id="ref-Pinheiro2016">
<p>Pinheiro, H.S.K., Chagas, C. da S., Carvalho Junior, W., Anjos, L.H.C., 2016. Ferramentas de pedometria para caracteriza√ß√£o da composi√ß√£o granulom√©trica de perfis de solos hidrom√≥rficos. Pesquisa Agropecu√°ria Brasileira 51, 1326‚Äì1338. <a href="https://doi.org/10.1590/S0100-204X2016000900032">https://doi.org/10.1590/S0100-204X2016000900032</a></p>
</div>
<div id="ref-Pinheiro2018">
<p>Pinheiro, H.S.K., Helena, L., Anjos, C., Xavier, P.A.M., Cesar, S., 2018. Quantitative pedology to evaluate a soil profile collection from the Brazilian semi-arid region. South African Journal of Geomatics 1862, 1‚Äì11. <a href="https://doi.org/10.1080/02571862.2017.1419385">https://doi.org/10.1080/02571862.2017.1419385</a></p>
</div>
</div>
</div>
